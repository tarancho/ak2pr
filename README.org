#+title: テキストファイル印刷ツール「ak2ps のようなもの」
#+author: T. Furukawa
#+options: ^:{} toc:nil

以下の時刻に更新しました。

#+BEGIN_EXAMPLE
Time-stamp: "2023-09-08 19:06:44 tfuruka1"
#+END_EXAMPLE

ドキュメントの内容は、2005年から殆ど更新されていませんので、かなり古い
事を記載している可能性があります。現在では嘘になっている可能性もありま
す。

実行ファイルのアーカイブは以下のリンクからダウンロードして下さい。

[[./ak2pr.zip][ak2pr.zip]]

- Ver. 2.6
- 〜とっても不親切なマニュアル〜

* 機能概要

本ツールは, コマンドラインから*も*使用可能なテキストファイルを印刷する
為のツールです。 *も* なので, GUI でも使用する事が可能です。

* 機能説明

本ツールは, テキストファイルを印刷するツールです。似たようなツールは沢
山あると思いますが, 大きな(小さなかも)特徴は,

 - コマンドラインから使用できる
 - 標準入力から読み込んだ内容を印字できる
 - でも, GUI でも使用できる

です。元々は, Emacs(Meadow)から使用する事を目的として作成しましたので,

 - Emacs の print-buffer, lpr-buffer 等と連携できる
 - Emacs の ps-print-buffer, ps-print-buffer-with-faces 等と連携して非
   PostScript プリンターでの印刷が可能。但し, 別途GhostScript 又は,
   Acrobat Distiller 等のソフトウエアが必要になります
 - Emacs 上で動作するメーラーである Mew の印刷機能と連携できる。
   X-Face, Faceも印刷可能です。

等の特徴があります。また, Emacs なんて使ってないよ。コマンドラインから
は使いにくいよ。という方の為(っていうか, 自分の為ですけど・・・)に

 - GUI でも使用可能
 - クリップボードの内容も印刷可能
 - ドラッグ&ドロップで印刷可能

となっています。特に, 大量にテキストファイルを印刷する必要がある時は,
フォルダ毎, ドラッグアンドドロップする事で, フォルダに含まれている全て
のファイルを印刷する事も可能です。それなりに細かいフォーマットの設定も
行う事ができます。

 - タブ幅の指定
 - フォントサイズの指定
 - プレビュー機能(後から追加したので・・・ですが)
 - 段組印刷(一応無限大・・・ 3段を超えると読みにくいでしょう)
 - 行番号の On/Off

等の機能を実装してしていますので, Emacs からだけではなく, 普通のテキス
ト印刷ツールとしても, それなりには使えると思います。

* 動作環境

一応, Windows(32bit)汎用です。

最初は, Windows NT 3.51で作り始めたんですが, 現在は環境が無いので, 試
せません。多分, 3.51ではもはや動作しないと思いますが, その他の Windows
では多分, 動作すると思います。因みに私の環境は, Windows NT 4.0です(今
は Windows Xp です)。

* 歴史

「ak2ps のようなもの」の名称の通り, a2ps と同じような事が出来る事を目
標として作成し始めました。といっても, a2ps もどんどん Version up して
いるので, 現在の a2ps とはかなり異なったものになっていると思います。

私が, UNIX を使用していた頃は, テキストファイルの印刷はもっぱら, a2ps
を使用していました。a2ps では, 日本語を印刷できないので, 自分で, 日本
語対応及び所謂半角カタカナを印刷できるように修正して ak2ps と改名して
使用していました(ただ, 当然, 同じ事を考える人は居るもので, 既に a2ps
は日本語化されていましたし, 名称も ak2ps で全く同じというのもありまし
た)。

そのうち, 私も Windows を使用するようになったのですが, エディタは相変
わらず, Emacs を使用していました(勿論現在も)。印刷も PostScript プリン
タを使用できる環境にあったので, UNIX の ak2ps を Windows 上でコンパイ
ルして, (ごく僅かな修正を施して)そのまま使用していました。

暫くして, PostScript プリンタを使用出来る環境には居られなくなってしま
いました。暫くは, GhostScript を使用して ak2ps を使用していたのですが,
やっぱり, 少々不便に感じるようになってきました。

そこで, フリーの印刷ツールを探してみたのですが, 殆どが GUI から使用す
るものばかりで, Emacs から簡単に使用できそうなものは見つかりませんでし
た(現在はそれなりに有りますね)。

そんなわけで, このツールの制作にかかったのですが, 作り始めてから公開す
るに至るまで, 実に 5年弱の月日が経過してしまいました(ただ単に, 公開す
るつもりがあまり無かっただけなんですけど)。その間に, RCS が吹っ飛んだ
りして修正履歴が分からなくなってしまった部分もあります。

* インストール方法

以下のファイルを同一の(新規)フォルダに格納して下さい。

 - ak2pr.dll :: 共通ダイナミックリンクライブラリ
 - ak2prSV.exe :: 印刷サーバ
 - ak2pr.exe :: コマンドライン用ツール
 - ak2prW.exe :: コマンドライン用ツール(コンソール無し)

頻繁にコマンドラインから使用する方は, PATH が張られているフォルダに格
納する事をお勧めします。

* アンインストール方法

インストール時に作成したフォルダを(中のファイル毎)削除して下さい。

* 使用方法
** 最初に行う事

最初に ak2prSV.exe を Explorer 等から起動して下さい。一番, 最初の起動に
限り, 起動時に「プリンタの設定」ダイアログが表示されますので,プリンタの
設定を行い, 「OK」ボタンをクリックして下さい。

タスクバーの右側に見慣れないアイコンが, 表示されますが, これが, 本ツー
ルの印刷屋さんです。

アイコンをダブルクリックすると, メインウインドウが表示されます。このメ
インウインドウに印刷したいファイルをドロップする事で, 印刷を行う事が出
来ます。

アイコンにマウスカーソルを合わせて, 右ボタンをクリックすると, メニュー
が表示されます。ちなみに, このメニューと, メインウインドウの「唯一のメ
ニュー」メニューの内容は全く同一のものです。また, メインウインドのツー
ルバーの内容もメニューと全く同じです。

全ての印刷は, ak2prSV.exe が受け持ちます。

** 起動オプション

以下に ak2prSV の起動オプションを示します。

    ak2prSV [-S]

    -S ak2pr を「印刷停止」状態で起動します。尚, Version 2.1以前では,
       起動時は常に「印刷停止」状態になるようになっていましたが, 2.1以
       降は本オプションを指定しない限りは, 印刷可能状態で起動します。
       私が, 間違えて, 無意味なファイルを大量印刷するのを抑止する為に
       のみに本オプションは存在します。(^^;このオプションは, ak2prSV
       を一番最初に起動したときのみ有効になります。ak2prSV が既に起動
       している状態の時に指定しても無視します(ak2prSV は複数起動できま
       せん)。

** 印刷スタイルの設定

印刷スタイルの設定は, メニューの「ページ設定...」又は, 「ドライバーとペ
ンチ」の絵が描画されているツールボタンを押下して行います。「共通設定」,
「e-mail 印刷」, 「テキスト印刷」,「PostScript」のタブを持ったダイアロ
グが表示されます。それぞれのタブで設定できる事を以下に記述します。

*** 「共通設定」タブ

 - フォントサイズ :: フォントサイズの設定を行います。デフォルトは 10 ポ
                     イントになっています。
 - 段組数 :: 段組数の設定を行います。デフォルトは 2段組になっています。

 - タブ幅 :: タブ幅の設定を行います。デフォルトは, 8になっています。

 - Default :: このボタンをクリックすると, デフォルトの設定を行います。

 - フォント名(本文) ::
 - フォント名(タイトル) ::
 - フォント名(行番号) ::
 - フォント名(その他) :: それぞれの印刷で使用するフォント名を指定します。
      デフォルトはそれぞれ, 「MS P 明朝」, 「MS P ゴシック」,
      「Courier New」, 「Arial」です。選択理由は以下の通りです。

      本文のフォントは, 日本語と欧文が混在している可能性が高いと思いま
      すので, 等幅フォントをデフォルトで選択しています。タイトルに使用
      するフォンとは少し目立ちそうなプロポーショナルフォントを選択して
      います。行番号は, 本文と同様, レイアウトが崩れないように等幅フォ
      ントを選択しています。その他(ページ番号等)は日本語が含まれる事は
      あまり無いと思いましたので,欧文のプロポーショナルフォントを選択し
      ました。

      ご自分の好みに合うフォントを選択して下さい。但し, 本文に日本語が
      含まれているのに, 欧文フォントを選択してしまうと, 印刷しても日本
      語が印刷されなくなりますので, ご注意下さい。

      因みに現在のところ, フォント名に関する設定は, コマンドラインから
      行う事は少ないと思いましたので, ak2pr や ak2prW からは設定する事
      は出来ません。

 - プレビュー確認後印刷する :: このチェックボックスがチェックされている
      状態の場合は, プレビュー画面が表示されます。このチェックボックス
      がチェックされていない場合は, 直ちに印刷を行います。

**** プレビュー画面で出来る事

プレビュー画面で出来る事を以下に記述します。

 - 印刷 :: Print ボタンを押下すると, プレビュー画面を閉じて印刷を開始し
          ます。

 - 印刷設定 :: Setup ボタンを押下すると, 印刷スタイルの設定を行う事が出
               来ます。設定内容は, 「印刷スタイルの設定」を参照して下さ
               い(ドキュメントが無限ループしちゃっていますね(^^;)。印刷
               設定が完了すると, 再度プレビュー画面になります。

 - 破棄 :: Cancel ボタンを押下すると, プレビュー画面を閉じます。印刷ド
           キュメントは破棄します。

 - COPYRIGHT を印刷しない :: このチェックボックスがチェックされている状
      態で印刷を行った場合は, 控えめに印字している COPYRIGHT を印字しま
      せん。チェックされていない場合は, 控えめに COPYRIGHT を印字します。

 - 短辺綴 :: 短辺綴で印刷する場合は, このチェックボックスをチェック状態
             に設定して下さい。デフォルトは長辺綴です。

 - 折り返さない :: このチェックボックスがチェック状態の場合は、印字時に
                   右側に食み出した文字を印刷しません。非チェック状態の
                   場合は、折り返して印刷します。

 - デバッグ用の印刷 :: 私用のチェックボックスです。

 - Printer :: このボタンをクリックすると, プリンタの設定ダイアログが表
              示されます。プリンタの設定を行って下さい。

*** 「e-mail 印刷」タブ

このタブで設定できる内容は, 実は, Emacs 上の Mew から印刷された時の事を
考慮しています。Emacs で Mew を使用しない方は読み飛ばして下さい。私は,
Mew を使用しているので, それ以外の MUA での確認はしていませんが, 多分,
Mew 以外でも印刷は可能と思われます。

 - カラー印刷 :: このチェックボックスがチェックされている場合, カラーで
                 印刷します。

 - 簡易ヘッダ印刷 :: このチェックボックスがチェックされている場合, メー
                     ルヘッダの Receive ヘッダを印刷しません。最近の
                     Mew は デフォルトで Receive ヘッダ等を印刷に渡さな
                     くなっていますので, あまり意味を成さなくなってしま
                     いました。

 - uncompfaceの場所(X-FACE) :: X-Face を印刷したい方は設定して下さい。
      uncompface.exe のパスをフルパスで指定して下さい。最近の Mew は,
      デフォルトではX-Face を印刷に渡さなくなっていますので, この設定の
      他にemacs 側の設定が必要になります。「Emacs 上の Mew から印刷
      を行う」の項も参照して下さい。

*** 「テキスト印刷」タブ

このタブでテキスト印刷時の書式を設定します。このタブで設定した内容は
e-mail印刷にも反映されます。

 - 行間の設定
   - 日本語に合わせる :: このラジオボタンをチェック状態にすると、行間を
        日本語を含むテキストを印刷する場合に読みやすい行間に設定します。
        欧文の設定より、やや広い行間になります。
   - 欧文に合わせる :: このラジオボタンをチェック状態にすると、欧文のみ
                       のテキストを印刷する場合に読みやすい行間に設定し
                       ます。
   - 兎に角沢山詰め込む :: このラジオボタンをチェック状態にすると、可能
        な限り（文字が重ならない範囲で）行間を詰めます。
   - 自動判別 :: このラジオボタンをチェック状態にすると、テキストを判別
                 し、行間を設定します。
 - その他の設定
   - 行番号を付ける :: このチェックボックスをチェック状態にすると, 行番
                       号を印刷します。チェックを外すと, 行番号の印刷を
                       行わなくなります。ただし, この設定よりも,
                       ak2pr, ak2prW の -n[-]オプションの方を優先します。
   - 罫線を連結する :: このチェックボックスをチェック状態にすると、罫線
                       文字を含む行を印刷する時に行間を詰めて、罫線を連
                       結して印刷します。

*** 「PostScript」タブ

このタブで設定できる内容は, Emacs で ps-print-buffer 等を使用した時に有
効になりますので, Emacs を使用しない方は読み飛ばして下さい。

 - Acrobat 関連 :: PostScript ファイルを Acrobat Distiller を使用して
                   PDF へ変換する場合は, 設定して下さい。Acrobat
                   Distiller の監視フォルダの[In]フォルダをフルパスで指
                   定して下さい。ak2psSv.exeは, ただたんにそのフォルダ
                   へファイルを格納するだけです。
 - GhostScript 関連 :: PostScript ファイルを GhostScript で印刷する方は
      指定して下さい。GhostScript のフルパスと, そのときのオプションを
      指定して下さい。Default ボタンを押下すると, デフォルトのオプショ
      ンを設定します。プレビュー後, 印刷を行い方は, GhostView を指定し
      てみても面白いと思います(私は良く使用しています)。

** クリップボード印刷

メニューの「クリップボード印刷」又は, 「クリップ」の絵のツールボタンを
押下すると, クリップボードの内容を印刷します(正確には, 印刷要求を行う)。
Ctrl キーを押下した状態で, V キーを押下しても同様の事を行います(実は
Ctrl-Y でも・・・私がよく間違えるので・・・)。

** テスト印刷

メニューの「テスト印刷」又は, 「テスト用紙」の絵のツールボタンを押下す
ると, テスト印刷を行います(正確には, 印刷要求を行う)。

** 印刷停止(再開)

メニューの「印刷停止」又は, 「止まれの標識」の絵のツールボタンを押下す
ると, 印刷の停止又は再開を行います。

** 印刷 Queue の削除

メインウインドウのリストビューで, 対象データを選択状態にして, メ
ニューの「印刷 Queue の削除」又は, 「リサイクルボックス」の絵のツー
ルボタンを押下すると, 印刷対象データが削除されます。

** 作者を励ます

メニューの「いろいろ」→「励ましのお便り」又は, 「封書」の絵のツールボ
タンを押下すると, 作者に励ましのお便りをだす事ができます。もちろんバグ
報告等も OK です。但し, あまり, 苛めないで下さい。

** 作者のホームページ

メニューの「いろいろ」→「作者のホームページ」又は, 「F」の絵のツー
ルボタンを押下すると, 作者のホームページが見れるかもしれません。

** 作者以外は必要の無い機能

メニューの「Debug」→「詳細ウインドウ」又は, 「変な顔」の絵のツールボタ
ンを押下すると, 作者以外には必要の無いウインドウが表示されます。

** 終了

メニューの「終了」又は, 「非常口」の絵のツールボタンを押下すると,本ツー
ルを終了する事ができます。

** プレビュー画面で出来る事

「印刷スタイルの設定→共通設定」タブで, 「プレビュー確認後印刷する」の
チェックを付けている場合, 印刷する前にプレビュー画面が表示されます。
「Print」, 「Setup」, 「Cancel」の三つのボタンと印刷イメージが表示され
ます。そのまま印刷する場合は「Print」を押下します。印刷を取り消す場合は
「Cancel」を押下します。レイアウトを変更する場合は「Setup」を押下して下
さい。「Setup」を押下した時に開く画面は, 「印刷スタイルの設定」と同じで
すが, ここで設定した値は, 現在のファイルに *のみ* 反映されます。また,
「個別設定」のタブが追加されています。このタブでは, 印刷タイトルを変更
する事が出来ます。但し変更可能な印刷タイトルはテキスト印刷のみです。

* 印刷する(GUI)

- 印刷したいファイルを Explorer で選択し, ak2prSV.exe のメインウインド
  ウにドラッグ&ドロップして下さい。フォルダをドロップした場合は, フォル
  ダに含まれる全てのファイルを印刷します。
- ak2prSV のメニューから「クリップボード印刷」を選択すると, クリップボー
  ドの内容の印刷を行います。ツールバーの「クリップ」の絵をクリックして
  も同様の事が行えます。さらに Ctrl-V でも可能です。ついでに Ctrl-Y で
  も OK です。

* コマンドラインから印刷する

コマンドラインから印刷する場合も, ak2prSV.exe が起動されている必要があ
りますので, 先に ak2prSV.exe を起動しておいて下さい(一応, ak2pr.exe,
ak2prW.exe から自動起動できるように作成していますが, 上手く起動できない
場合があります---最近はこの問題は出にくくなっています)。

コマンドラインから印刷する場合は, ak2pr.exe 又は ak2prW.exe を使用します。
これらのコマンドは, 標準入力から印刷データを読み取る事も出来ます。但し,
ak2prW.exe は, コンソールを持っていませんので, 特殊な環境下以外(標準入
力を ak2prW.exe に与える環境以外)では, 標準入力データを印刷する事は出来
ません。ak2pr.exe と ak2prW.exe の違いは, コンソールを持っているか, 持っ
ていないかだけです。

以下の使用方法を記述します。ak2pr.exe, ak2prW.exe 共に同様です。以下の
記述に「デフォルトはサーバの設定」が多数ありますが, これは,
ak2prSV.exe のページ設定で行った内容という意味です。

#+BEGIN_EXAMPLE
Usage: ak2pr [-o{p|l}] [-m{PLAIN|MAIL|PS_ACROBAT|PS_GHOST}]
             [-fフォントサイズ] [-tタブ幅] [-u段組数] [-Tタイトル]
             [-Jタイトル] [-s用紙サイズ] [-n[-]] [-P] [-S] [-b{s|l}]
             [-l{m|s}]
             [ファイル名...]
#+END_EXAMPLE

特に明記していない限り、オプションを省略した場合の動作は
サーバの設定値を使用します。

 - -o :: 用紙の向きを指定します。デフォルトはサーバの設定。
   - p PORTRAIT
   - l LANDSCAPE
 - -m :: ファイルの種類を指定します。デフォルトはプレーンテキスト。
   - PLAIN      プレーンテキストファイル
   - MAIL       インターネットメール(SJIS)
   - PS_ACROBAT PostScriptファイル(Acrobat Distillerで変換)
   - PS_GHOST   PostScriptファイル(GhostScriptで印刷)
 - -f :: フォントサイズを指定します。
 - -t :: タブ幅を指定します。
 - -u :: 段組数を指定します。
 - -T :: タイトルを指定します(-Jと同じ)。デフォルトはファイル名。
 - -J :: タイトルを指定します(-Tと同じ)。デフォルトはファイル名。
 - -s :: 用紙サイズを指定します。
 - -n[-] :: 行番号を出力します。 -n- を指定した場合は行番号を出力しない。
 - -P :: 指定しても何もしません。
 - -S :: サーバを起動する時に印刷停止状態で起動します。サーバが既に起動
         している場合は意味を持ちません。
 - -b :: 長辺綴じ・短辺綴じを指定します。
   - s 短辺綴じ
   - l 長辺綴じ
 - -l :: 文字が右側に食み出した時の動作を指定します。
   - m マルチライン(右側に食み出した文字は折り返して印刷)
   - s シングルライン(右側に食み出した文字は印刷しません)
 - ファイル名 :: 印刷するファイル名を指定します。
                 指定しなかった場合は、標準入力から読み込みます。
                 複数ファイル指定できます。

用紙サイズは以下の何れかを指定して下さい。但し, 全てのオプションが全て
のプリンタで有効とは限りません。

| オプション         | 説明                                   |
|--------------------+----------------------------------------|
| A3                 | A3シート, 297× 420ミリメートル        |
| A4                 | A4シート, 210× 297ミリメートル        |
| A4SMALL            | A4 small シート, 210× 297ミリメートル |
| A5                 | A5シート, 148× 210ミリメートル        |
| B4                 | B4シート, 250× 354ミリメートル        |
| B5                 | B5シート, 182× 257ミリメートル        |
| LETTER             | Letter, 8 1/2× 11インチ               |
| LEGAL              | Legal, 8 1/2× 14インチ                |
| CSHEET             | C シート, 17× 22インチ                |
| DSHEET             | D シート, 22× 34インチ                |
| ESHEET             | E シート, 34× 44インチ                |
| LETTERSMALL        | Letter Small, 8 1/2× 11インチ         |
| TABLOID            | Tabloid, 11× 17インチ                 |
| LEDGER             | Ledger, 17× 11インチ                  |
| STATEMENT          | Statement, 5 1/2× 8 1/2インチ         |
| EXECUTIVE          | Executive, 7 1/4× 10 1/2インチ        |
| FOLIO              | Folio, 8 1/2× 13インチ                |
| QUARTO             | Quarto, 215× 275ミリメートル          |
| 10X14              | 10× 14インチシート                    |
| 11X17              | 11× 17インチシート                    |
| NOTE               | Note, 8 1/2× 11インチ                 |
| ENV_9              | #9 Envelope, 3 7/8× 8 7/8インチ       |
| ENV_10             | #10 Envelope, 4 1/8× 9 1/2インチ      |
| ENV_11             | #11 Envelope, 4 1/2× 10 3/8インチ     |
| ENV_12             | #12 Envelope, 4 3/4× 11インチ         |
| ENV_14             | #14 Envelope, 5× 11 1/2インチ         |
| ENV_DL             | DL Envelope, 110× 220ミリメートル     |
| ENV_C5             | C5 Envelope, 162× 229ミリメートル     |
| ENV_C3             | C3 Envelope, 324× 458ミリメートル     |
| ENV_C4             | C4 Envelope, 229× 324ミリメートル     |
| ENV_C6             | C6 Envelope, 114× 162ミリメートル     |
| ENV_C65            | C65 Envelope, 114× 229ミリメートル    |
| ENV_B4             | B4 Envelope, 250× 353ミリメートル     |
| ENV_B5             | B5 Envelope, 176× 250ミリメートル     |
| ENV_B6             | B6 Envelope, 176× 125ミリメートル     |
| ENV_ITALY          | Italy Envelope, 110× 230ミリメートル  |
| ENV_MONARCH        | Monarch Envelope, 3 7/8× 7 1/2インチ  |
| ENV_PERSONAL       | 6 3/4 Envelope, 3 5/8× 6 1/2インチ    |
| FANFOLD_US         | US Std Fanfold, 14 7/8× 11インチ      |
| FANFOLD_STD_GERMAN | German Std Fanfold, 8 1/2× 12インチ   |
| FANFOLD_LGL_GERMAN | German Legal Fanfold, 8 1/2× 13インチ |

*  Emacs(Meadow)から印刷する
**  Emacs のバッファの内容を印刷する

Emacs のバッファの内容を印刷する場合は, 通常通り, lpr-buffer,
print-buffer, lpr-region, print-region 等から印刷できます。但し,
.emacs 等で以下の設定を行って下さい。
#+BEGIN_SRC elisp
(setq lpr-command
      (expand-file-name (concat exec-directory
                                "../../site-bin/ak2pr.exe")))
(setq lpr-switches '())
(setq lpr-add-switches t)
(setq lpr-command-switches '())
#+END_SRC

lpr-command で ak2pr.exe の場所を指定します。上記の例は, Meadow のイ
ンストールフォルダの直下に site-bin というフォルダを作成して, そこに
本ツールをインストールした場合の例です。

#+BEGIN_EXAMPLE
      Meadow
      ├─ 1.15
      │  ├─ bin        ← ここが exec-directory
      │  ├─ data
      │  ├─ etc
      │  ├─ info
      │  ├─ leim
      │  ├─ lisp
      │  ├─ lock
      │  └─ site-lisp
      ├─ site-bin       ←ここにインストールした例
      ├─ site-info
      └─ site-lisp
#+END_EXAMPLE

ak2pr のオプションを固定で指定する場合は, lpr-switches に指定します。例
えば, 常に用紙を横置き, フォントサイズを 9ポイント, 二段組,用紙サイズを
A4, 長辺綴じに設定する場合は以下のように設定します。

#+BEGIN_SRC elisp
(setq lpr-switches '("-ol" "-f9" "-u2" "-sA4" "-bl"))
#+END_SRC

私のように, 間違えて意味のない用紙を沢山出力してしまう方は, -S オプショ
ンを常に指定しておくと良いでしょう(そんな奴は居ないって)。

#+BEGIN_SRC elisp
(setq lpr-switches '("-S"))
#+END_SRC

**  Emacs のバッファの内容を印刷する(PostScript)

Emacs の ps-print-buffer, ps-print-buffer-with-faces, ps-print-region,
ps-print-region-with-faces を使用して非 PostScriptプリンタで印刷を行う
事も可能です。その場合は, 上記の例で, lpr-command の設定を行っている事
が前提ですが, 更に以下の設定を.emacs 等で行って下さい。

#+BEGIN_SRC elisp
(setq ps-multibyte-buffer 'non-latin-printer ;マルチバイト印刷を行う
          ps-line-number t                  ;行番号を印刷する
          ps-paper-type 'a4                 ;用紙サイズは A4
          ps-landscape-mode t               ;用紙は横置き
          ps-number-of-columns 2            ;2段組
          ps-lpr-command lpr-command        ;lpr と同じ
          ps-lpr-switches '("-mPS_GHOST")   ;GhostScript に処理させる
          )
#+END_SRC

ps-lpr-switches の設定を "-mPS_ACROBAT" に変更する事により, Acrobat
Distiller で処理させる事も可能です。又, 他の PostScript の設定に関して
は, 関連ドキュメント等を参照して下さい。

**  Emacs 上の Mew から印刷を行う

通常通り, Mew から mew-summary-print で印刷を行う事が出来ます。以下の設
定を.emacs 等で行って下さい。

#+BEGIN_SRC elisp
(setq mew-print-command-format
      (expand-file-name (concat exec-directory
                                "../../site-bin/ak2pr.exe -mMAIL")))
(defun mew-print-region (begin end)
  (interactive "r")
  (shell-command-on-region begin end mew-print-command-format))

(defun mew-print-buffer ()
  (interactive)
  (mew-print-region (point-min) (point-max)))

(setq mew-print-function (function mew-print-buffer))
#+END_SRC

この設定の詳細については, Mew の FAQ 等を参照して下さい。この設定で
ak2pr の設定を mew-print-command-format に行っています。インストールす
る位置によって, 設定内容は異なります。詳しくは, 「Emacs のバッファの内
容を印刷する」を参照してください。

Mew で印刷を行った場合, Message-ID が常に「わかりまへん」と印刷される場
合や, X-Face が含まれているのに, X-Face が印刷されない場合は,
*scratch*バッファで

#+BEGIN_EXAMPLE
mew-field-for-printing
#+END_EXAMPLE

を確認してみてください。その結果に Message-ID: や X-Face: が含まれ
ていない場合は, 上記のような現象になります。デフォルトでは,

#+BEGIN_EXAMPLE
("Subject:" "From:" "To:" "Cc:" "Date:")
#+END_EXAMPLE

になっていると思いますので, その場合は, .emacs 等で
mew-field-for-printing を再定義して下さい。例えば,

#+BEGIN_SRC elisp
(setq mew-field-for-printing
 '("Subject:" "From:" "To:" "Cc:" "Date:"
  "Message-ID:" "X-Face:"))
#+END_SRC

等としたり, あるは,
#+BEGIN_SRC elisp
(if (not (member "Message-ID:" mew-field-for-printing))
    (setq mew-field-for-printing
          (cons "Message-ID:"
                mew-field-for-printing)))
(if (not (member "X-Face:" mew-field-for-printing))
    (setq mew-field-for-printing
          (cons "X-Face:"
                mew-field-for-printing)))
#+END_SRC

等と定義する事によって, Message-ID や X-Face が印刷されるようになります。
X-Face の場合は uncompface の設定も確認してみて下さい。

* 著作権, 免責等

本ツールは, フリーソフトウエアです。入手したアーカイブのままの形式であ
れば, 再頒布, 転載は可能とします。但し, このソフトウエアを使用した事に
よって発生した損害等は, 如何なる場合においても, 作者には責任は無い事と
します。個人の責任において使用して下さい。

* バグ報告等

バグ報告, 改善案(あるいは, 自分で改善した), 質問等ありましたら, 是非作
者へ「励ましのお便り」(^^;を送って下さい。特にご自分で改善なさった場合
は, 私も恩恵に預かりたいので, 是非教えて下さい。

メールアドレスは, 以下の通りです。

#+BEGIN_EXAMPLE
tfuruka1 at nifty.com
#+END_EXAMPLE

改善案のご連絡を下さっても, 仕事に忙殺されている関係上, ご希望に添える
事は出来ないかもしれませんが, 言うだけは, ただですので・・・(^^;

* 雑多な事

本ツールは, 環境変数 TEMP で指定されたフォルダの下に「ak2prTempDir0」と
いう名称のフォルダを作成し, その下に作業ファイルを作成します。これらの
ファイルは, ak2prSV.exe が終了する時に全て削除される筈ですが, もし, 残っ
ている場合は, 「ak2prTempDir0」フォルダ毎, 削除して下さい。また, ファイ
ルが残る現象を再現できる場合は, 再現方法をメールでお知らせ下さい。

コンパイル方法については, 特に記述致しません。私は VC6.0でコンパイルし
ていますが, 多分, もっと低い Version でも大丈夫だと思います。

#+BEGIN_EXAMPLE
nmake
#+END_EXAMPLE

だけで, コンパイル出来る筈です。

ん〜っと。ak2pr.dll が何故, 存在するかというと, 一応, ak2pr.exe や,
ak2prW.exe のようなクライアント(と呼んで良いかは別として)ツールが簡単に
作成できるようにしているんです。ak2pr.dll で定義している API を使用して,
その時々に応じた印刷ツールを簡単に作成出来るように・・・というのが, 最
初の目的でした(一応, 今もそのつもりなんですけど)。

一部, デバッグ用に Syslog 出力しています。Syslogd を起動している方は,
ご注意(べつに悪さは与えないと思いますが)ください。

* 更新履歴

 - ★ Ver. 2.6 (APPI-KOGEN) 2012/08/14
   - メール印刷でFaceも印刷できるようにしました。
   - メール印刷時に簡易ヘッダ印刷以外の場合でも生のX-FaceとFaceヘッダは
     印刷しないようにしました。
 - ★ Ver. 2.5 (MATSUO-HACHIMANTAI) 2005/05/11
   - メール印刷したときに, ヘッダの 2 行目以降が文字化けする問題を修正
     しました。Ver. 2.4 での修正はカラー印刷時の場合は改修されていまし
     たが, モノクロ印刷の時の対応が不十分でした。--- 本件は茅野様に御指
     摘及び, 修正案を御教示頂きました ---
   - 行番号を印刷している状態で, 文字を折り返す場合に折り返し行以降の先
     頭文字の位置を一行目の行番号を除いた位置と同じになるようにしました。
   - シングルライン印刷(ようするに, 右側に文字が食み出した部分は印刷さ
     れない)に対応しました。また、コマンド引数のオプションにも追加しま
     した。
   - 細かい事ですが, GhostScript の実行ファイルをファイル選択ダイアログ
     ボックスから選択できるようにしました。
   - どうでもよい事ですが, Version 情報のダイアログを追加しました。因に,
     今迄はテスト印刷で確認できるようになっていました。
   - メール印刷でX-Faceを印刷できるようにしました。
 - ★ Ver. 2.4 (KITAMORI) 2004/08/30
   - メール印刷したときに, ヘッダの 2行目以降が文字化けする問題を修正し
     ました。
   - テキスト印刷で, 行間の設定と, 罫線の連結が出来るようになりました。
   - メール印刷の時に, ヘッダ部とボディ部の区切りを「--------」(ハイフォ
     ン 8つ)でも認識するようにしました(MH 形式のメッセージにも対応出来
     るようにしました)。
   - メール印刷で罫線が連結しない場合がある問題を修正しました。罫線文字
     が現れる前に 2バイト文字があると罫線が連結していませんでした。
#+BEGIN_EXAMPLE
        古┃ ←このパターンが連結出来ていなかった
 　     ━┛

        ┃古 ←このパターンはOKだった。
        ┗━
#+END_EXAMPLE

 - ★ Ver. 2.3 (TAIRADATE) 2004/01/24
   - 印刷フォントを指定出来るようにしました。
   - Emacs から使用する場合で, バッファ名にリダイレクト記号等が含まれて
     いると, 印刷出来なかった問題を修正しました。Ver.2.1での修正漏れで
     す。
   - 長辺綴じと短辺綴じを指定できるようにしました(従来は長辺綴じのみ)。
     平たく言うと, 「A4縦で印刷した際の上部にパンチ穴マークと三角印を印
     字出来るようになった」という事です。
   - 特に動作に影響は無かったのですが, Emacs の ps-print-xxxxx で印刷を
     行うときに, /D:PRN オプションをファイル名(ak2pr ではディレクトリセ
     パレータに'/'を許しています)と認識していたので, 無視するようにしま
     した。
   - 露見していなかったが, メモリ破壊を起こす可能性のある部分を修正しま
     した。
 - ★ Ver. 2.2 (OBUKE) 2003/03/29
   - クリップボードの内容を印刷できるようにしました。
   - キューイング後のドキュメントの印刷タイトルを, ページ設定で変更出来
     るようにしました。
   - プレビュー時に書式の再設定を出来るようにしました。プレビュー自体が
     後から追加した機能なので, あまり綺麗には実装できませんですたが, 取
     りあえず用件は満たしているかな・・・っと
   - PostScript ファイルを処理するときのファイル名が判りにくかったので,
     ファイル名のベースを PostScript ファイルの「%%Title:」フィールドか
     ら得るようにしました。また, Acrobat Distiller で処理するファイルに
     拡張子として, '.PS' を付加するようにしました。
   - ak2prSV の起動時に必ず「印刷停止」状態になる仕様を止めました(印刷
     可能状態にしました)。合わせて, 起動時に「印刷停止」状態にする為の
     起動オプションを追加しました。同様に ak2pr, ak2prW にもサーバの起
     動オプション -S を追加しました。
   - 「印刷停止」の状態がメニューとツールボタンで一致しない事(ツールボ
     タンの操作は, メニューに反映されるけど, メニューの操作がツールバー
     に反映されない)があるバグを修正しました。
   - ツールバーにツールチップを付けました。ま〜, あまり意味は無いんです
     けど。

 - ★ Ver. 2.1 (HIGASHI-OBUKE) 2003/03/01
   - 前回のリリースを 2.0としてしまったが, 実は 1.7でした。そんなわけで,
     1.7から 2.1にヴァージョンアップすることにしました。
   - 行番号の印刷を抑止できるように -n オプションを追加しました。また,
     サーバ側でも「行番号」印刷の On/Off を制御できるようにしました。メー
     ルの印刷にも行番号は有効です。
   - Emacs から印刷するときに, *scratch*バッファのように, ファイルをも
     たないバッファで, バッファ名に * や : が含まれていると, 印刷が出来
     なかった問題を修正しました。
   - e-mail 印刷を少しだけカラフルにしました。
   - ページ設定の e-mail タブの内容がクリア(特定の手順で操作を行った場
     合)される場合があったので, 修正しました。
   - ページ設定の PostScript タブの内容がキャンセルを選択しても反映され
     てしまう問題を修正しました。

 - ★ Ver. 1.7 (KOMA) 2001/12/23
   - 正式公開 Version.

これ以前の Version に関しては履歴不明

* To Do

いつ対応できるか・・・

- メール印刷でFaceに対応する(2005/5/21)
- 偶数頁と奇数頁でレイアウトをきりかえる(2004/12/20)
- 2ぺージ目以降のプレビュー(2002/4/22)
  - 2ページ目以降のプレビューを可能にする。プレビュー自体, 後から追加した機能なので, 実現は難しいかも・・・
- 印刷キューのプレビュー(2003/4/15)
  - 要望はあるのですが・・・
- Meadow2で印刷すると, 半角豆腐が行末に印刷される場合がある件の修正。
  - 多分, 行末が^M^M になっている為と思われる。(2003/8/1)→どうやら
    Meadow2と Mule-UCS の相性っぽいです。SJIS-DOS の改行コードが
    CR+CR+LF になっているようです。カレントの Mule-UCS に変えたら当該現
    象は発生しなくなりました。とりあえず ak2pr では対応しない方向ですが,
    このメモは残しておきます。
